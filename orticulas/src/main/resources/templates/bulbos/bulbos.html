<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Bulbos - Lista e Cadastro</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" />
</head>
<body class="container mt-4">

    <h1>Cadastro de Bulbo</h1>

    <form action="#" th:action="@{/bulbos/salvar}" th:object="${bulbo}" method="post" enctype="multipart/form-data" class="mb-5">

        <div class="row mb-3">
            <div class="col">
                <label for="id" class="form-label">ID</label>
                <input type="number" th:field="*{id}" id="id" class="form-control" required />
            </div>
            <div class="col">
                <label for="nomePopular" class="form-label">Nome Popular</label>
                <input type="text" th:field="*{nomePopular}" id="nomePopular" class="form-control" required />
            </div>
        </div>

        <div class="row mb-3">
            <div class="col">
                <label for="nomeCientifico" class="form-label">Nome Científico</label>
                <input type="text" th:field="*{nomeCientifico}" id="nomeCientifico" class="form-control" required />
            </div>
            <div class="col">
                <label for="preco" class="form-label">Preço</label>
                <input type="text" th:field="*{preco}" id="preco" class="form-control" required />
            </div>
        </div>

        <div class="mb-3">
            <label for="descricao" class="form-label">Descrição</label>
            <textarea th:field="*{descricao}" id="descricao" class="form-control" rows="3"></textarea>
        </div>

        <div class="row mb-3">
            <div class="col">
                <label for="dataColheita" class="form-label">Data da Colheita</label>
                <input type="date" th:field="*{dataColheita}" id="dataColheita" class="form-control" required />
            </div>
            <div class="col">
                <label for="estado" class="form-label">Estado</label>
                <input type="text" th:field="*{estado}" id="estado" class="form-control" required />
            </div>
        </div>

        <div class="mb-3">
            <label for="imagem" class="form-label">Imagem (JPEG/PNG)</label>
          
          <input type="file" id="imagem" name="fileImagem" class="form-control" accept="image/*" />


        </div>

        <button type="submit" class="btn btn-success">Adicionar Bulbo</button>
    </form>

    <hr />

    <h2>Lista de Bulbos</h2>

    <form method="get" th:action="@{/bulbos/listar}" class="mb-3">
        <input type="text" name="nome" th:value="${nome}" placeholder="Pesquisar por nome" class="form-control" />
        <button type="submit" class="btn btn-primary mt-2">Pesquisar</button>
    </form>

    <table class="table table-bordered table-hover">
        <thead class="table-light">
            <tr>
                <th>ID</th>
                <th>Nome Popular</th>
                <th>Nome Científico</th>
                <th>Descrição</th>
                <th>Imagem</th>
                <th>Preço</th>
                <th>Data Colheita</th>
                <th>Estado</th>
                <th>Ações</th>
            </tr>
        </thead>
        <tbody>
            <tr th:each="bulbo : ${bulbos}">
                <td th:text="${bulbo.id}">1</td>
                <td th:text="${bulbo.nomePopular}">Alho</td>
                <td th:text="${bulbo.nomeCientifico}">Allium sativum</td>
                <td th:text="${bulbo.descricao}">Descrição</td>
                <td>
                    <img th:if="${bulbo.imagem != null}" 
                         th:src="'data:image/jpeg;base64,' + ${T(org.apache.tomcat.util.codec.binary.Base64).encodeBase64String(bulbo.imagem)}" 
                         alt="Imagem do bulbo" style="max-height: 100px;" />
                    <span th:if="${bulbo.imagem == null}">Sem imagem</span>
                </td>
                <td th:text="${bulbo.preco}">10.50</td>
                <td th:text="${bulbo.dataColheita}">2025-08-10</td>
                <td th:text="${bulbo.estado}">Disponível</td>
                <td>
                    <a th:href="@{/bulbos/editar(id=${bulbo.id})}" class="btn btn-warning btn-sm">Editar</a>
                </td>
            </tr>
        </tbody>
    </table>

    <div th:if="${mensagem != null}" class="alert alert-info mt-3" th:text="${mensagem}"></div>

</body>
</html>
